# Makefile pour InnovHack - Personal Shopper IA
# Usage: make <commande>

.PHONY: help install dev build preview clean stop logs test

# Couleurs pour les messages
GREEN  := \033[0;32m
YELLOW := \033[0;33m
RED    := \033[0;31m
NC     := \033[0m # No Color

# Commande par d√©faut
.DEFAULT_GOAL := help

## help: Affiche cette aide
help:
	@echo "$(GREEN)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo "$(GREEN)  InnovHack - Personal Shopper IA - Commandes$(NC)"
	@echo "$(GREEN)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo ""
	@echo "$(YELLOW)Installation :$(NC)"
	@echo "  make install      - Installer les d√©pendances"
	@echo ""
	@echo "$(YELLOW)D√©veloppement :$(NC)"
	@echo "  make dev          - Lancer en mode d√©veloppement"
	@echo "  make stop         - Arr√™ter le serveur de dev"
	@echo "  make logs         - Voir les logs en temps r√©el"
	@echo ""
	@echo "$(YELLOW)Production :$(NC)"
	@echo "  make build        - Compiler pour la production"
	@echo "  make preview      - Pr√©visualiser le build"
	@echo ""
	@echo "$(YELLOW)Maintenance :$(NC)"
	@echo "  make clean        - Nettoyer les fichiers temporaires"
	@echo "  make test         - Tester la configuration"
	@echo ""
	@echo "$(GREEN)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"

## install: Installer les d√©pendances npm
install:
	@echo "$(GREEN)üì¶ Installation des d√©pendances...$(NC)"
	@npm install
	@echo "$(GREEN)‚úÖ D√©pendances install√©es !$(NC)"

## dev: Lancer le serveur de d√©veloppement
dev:
	@echo "$(GREEN)üöÄ Lancement du serveur de d√©veloppement...$(NC)"
	@echo "$(YELLOW)   ‚Üí http://localhost:5173$(NC)"
	@echo "$(YELLOW)   ‚Üí Appuie sur Ctrl+C pour arr√™ter$(NC)"
	@npm run dev

## stop: Arr√™ter le serveur de d√©veloppement
stop:
	@echo "$(RED)‚èπÔ∏è  Arr√™t du serveur...$(NC)"
	@pkill -f "vite" || echo "$(YELLOW)Aucun serveur en cours$(NC)"
	@echo "$(GREEN)‚úÖ Serveur arr√™t√©$(NC)"

## build: Compiler l'application pour la production
build:
	@echo "$(GREEN)üî® Compilation pour la production...$(NC)"
	@npm run build
	@echo "$(GREEN)‚úÖ Build termin√© ! Fichiers dans /dist$(NC)"

## preview: Pr√©visualiser le build de production
preview:
	@echo "$(GREEN)üëÄ Pr√©visualisation du build...$(NC)"
	@npm run preview

## clean: Nettoyer les fichiers temporaires
clean:
	@echo "$(YELLOW)üßπ Nettoyage...$(NC)"
	@rm -rf node_modules dist .vite
	@echo "$(GREEN)‚úÖ Nettoyage termin√©$(NC)"

## logs: Afficher les informations syst√®me
logs:
	@echo "$(GREEN)üìä Configuration syst√®me :$(NC)"
	@echo ""
	@echo "$(YELLOW)Node.js :$(NC) $$(node --version)"
	@echo "$(YELLOW)npm :$(NC) $$(npm --version)"
	@echo ""
	@echo "$(YELLOW)Variables d'environnement :$(NC)"
	@if [ -f .env ]; then \
		grep -v '^#' .env | grep -v '^$$' | sed 's/=.*/=***/' || true; \
	else \
		echo "$(RED)  Fichier .env introuvable$(NC)"; \
	fi
	@echo ""
	@echo "$(YELLOW)Produits dans le catalogue :$(NC)"
	@if [ -f src/data/products.json ]; then \
		echo "  $$(cat src/data/products.json | grep -c '"id"') produits"; \
	else \
		echo "$(RED)  Fichier products.json introuvable$(NC)"; \
	fi

## test: Tester la configuration
test:
	@echo "$(GREEN)üß™ V√©rification de la configuration...$(NC)"
	@echo ""
	@echo "$(YELLOW)1. V√©rification de Node.js...$(NC)"
	@node --version > /dev/null && echo "  ‚úÖ Node.js install√©" || echo "  ‚ùå Node.js manquant"
	@echo ""
	@echo "$(YELLOW)2. V√©rification des d√©pendances...$(NC)"
	@if [ -d node_modules ]; then \
		echo "  ‚úÖ D√©pendances install√©es"; \
	else \
		echo "  ‚ùå D√©pendances manquantes (lance: make install)"; \
	fi
	@echo ""
	@echo "$(YELLOW)3. V√©rification du fichier .env...$(NC)"
	@if [ -f .env ]; then \
		echo "  ‚úÖ Fichier .env pr√©sent"; \
		if grep -q "ta_cle_featherless_ici" .env; then \
			echo "  ‚ö†Ô∏è  Cl√© Featherless non configur√©e"; \
		else \
			echo "  ‚úÖ Cl√© Featherless configur√©e"; \
		fi; \
	else \
		echo "  ‚ö†Ô∏è  Fichier .env manquant (lance: cp .env.example .env)"; \
	fi
	@echo ""
	@echo "$(YELLOW)4. V√©rification des produits...$(NC)"
	@if [ -f src/data/products.json ]; then \
		echo "  ‚úÖ Catalogue de produits pr√©sent ($$(cat src/data/products.json | grep -c '"id"') produits)"; \
	else \
		echo "  ‚ùå Catalogue de produits manquant"; \
	fi
	@echo ""
	@if [ -d node_modules ] && [ -f .env ] && [ -f src/data/products.json ]; then \
		echo "$(GREEN)‚úÖ Configuration OK ! Lance: make dev$(NC)"; \
	else \
		echo "$(RED)‚ùå Configuration incompl√®te$(NC)"; \
	fi

## status: V√©rifier si le serveur tourne
status:
	@if pgrep -f "vite" > /dev/null; then \
		echo "$(GREEN)‚úÖ Serveur en cours d'ex√©cution$(NC)"; \
		echo "$(YELLOW)   ‚Üí http://localhost:5173$(NC)"; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Serveur arr√™t√©$(NC)"; \
		echo "$(YELLOW)   Lance: make dev$(NC)"; \
	fi

## restart: Red√©marrer le serveur
restart: stop dev

## setup: Installation compl√®te (premi√®re utilisation)
setup:
	@echo "$(GREEN)üéØ Configuration initiale du projet...$(NC)"
	@echo ""
	@echo "$(YELLOW)√âtape 1/3 : Installation des d√©pendances$(NC)"
	@make install
	@echo ""
	@echo "$(YELLOW)√âtape 2/3 : Configuration de l'environnement$(NC)"
	@if [ ! -f .env ]; then \
		cp .env.example .env; \
		echo "  ‚úÖ Fichier .env cr√©√©"; \
		echo "  ‚ö†Ô∏è  Pense √† remplir ta cl√© Featherless !"; \
	else \
		echo "  ‚úÖ Fichier .env d√©j√† pr√©sent"; \
	fi
	@echo ""
	@echo "$(YELLOW)√âtape 3/3 : V√©rification$(NC)"
	@make test
	@echo ""
	@echo "$(GREEN)üéâ Setup termin√© ! Lance: make dev$(NC)"
